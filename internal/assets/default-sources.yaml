$schema: https://raw.githubusercontent.com/gopak/gopak-cli/HEAD/schema/gopak.schema.json

# Default popular package manager sources for gopak
# You can copy snippets from here into your ~/.config/gopak/config.yaml

sources:
  - type: package_manager
    name: apt
    install:
      command: "apt install -y {package_list}"
      require_root: true
    remove:
      command: "apt remove -y {package_list}"
      require_root: true
    update:
      command: "apt install --only-upgrade -y {package_list}"
      require_root: true
    pre_update:
      command: "tmpdir=\"$(mktemp -d)\" && apt-get -o Dir::State::status=\"$tmpdir/status\" -o Dir::State::Lists=\"$tmpdir/lists\" -o Dir::Cache::Archives=\"$tmpdir/archives\" update"
      require_root: false
    search:
      command: "apt search {query}"
      require_root: false
    get_installed_version:
      command: "dpkg-query -W -f='${Version}' {package}"
      require_root: false
    get_latest_version:
      command: "apt-cache policy {package} | awk '/Candidate:/ {print $2}'"
      require_root: false

  - type: package_manager
    name: pacman
    install:
      command: "pacman -S --noconfirm {package_list}"
      require_root: true
    remove:
      command: "pacman -Rns --noconfirm {package_list}"
      require_root: true
    update:
      command: "pacman -S --noconfirm {package_list}"
      require_root: true
    pre_update:
      command: "tmpdir=\"$(mktemp -d)\" && pacman -Sy --noconfirm --dbpath \"$tmpdir/db\" --cachedir \"$tmpdir/cache\" --logfile \"$tmpdir/pacman.log\""
      require_root: false
    search:
      command: "pacman -Ss {query}"
      require_root: false
    get_installed_version:
      command: "pacman -Qi {package} | grep '^Version' | head -n1 | awk '{print $3}'"
      require_root: false
    get_latest_version:
      command: "pacman -Si {package} | awk '/^Version/ {print $3}'"
      require_root: false

  - type: package_manager
    name: snap
    install:
      command: "snap install {package_list}"
      require_root: true
    remove:
      command: "snap remove {package_list}"
      require_root: true
    update:
      command: "snap refresh {package_list}"
      require_root: true
    search:
      command: "snap find {query}"
      require_root: false
    get_installed_version:
      command: "snap info {package} | grep '^installed:' | head -n1 | awk '{print $2}'"
      require_root: false
    get_latest_version:
      command: "tracking=$(snap info {package} | awk -F':' '/^tracking/ {gsub(/^[ \t]+/,\"\",$2); gsub(/[ \t]+$/,\"\",$2); print $2; exit}'); snap info {package} | awk -v t=\"$tracking\" '$1 == t\":\" {print $2; exit}'"
      require_root: false

  - type: package_manager
    name: flatpak
    install:
      command: "flatpak install -y {package_list}"
      require_root: false
    remove:
      command: "flatpak uninstall -y {package_list}"
      require_root: false
    update:
      command: "flatpak update -y {package_list}"
      require_root: false
    pre_update:
      command: "flatpak update --user --appstream"
      require_root: false
    search:
      command: "flatpak search {query}"
      require_root: false
    get_installed_version:
      command: "flatpak info {package} 2>/dev/null | sed -n 's/^[[:space:]]*Version:[[:space:]]*//p' | head -n1 || true"
      require_root: false
    get_latest_version:
      command: "origin=$(flatpak info {package} 2>/dev/null | sed -n 's/^[[:space:]]*Origin:[[:space:]]*//p' | head -n1); if [ -n \"$origin\" ]; then flatpak remote-info \"$origin\" {package} 2>/dev/null | sed -n 's/^[[:space:]]*Version:[[:space:]]*//p' | head -n1; fi || true"
      require_root: false

  - type: package_manager
    name: pipx
    install:
      command: "printf \"%s\n\" {package_list} | xargs -n1 pipx install"
      require_root: false
    remove:
      command: "printf \"%s\n\" {package_list} | xargs -n1 pipx uninstall"
      require_root: false
    update:
      command: "printf \"%s\n\" {package_list} | xargs -n1 pipx upgrade"
      require_root: false
    search:
        command: "echo \"Please use https://pypi.org/search (via a browser).\""
        require_root: false
    get_installed_version:
      command: "pipx runpip {package} show {package} | awk '/^Version:/\{print $2\}'"
      require_root: false
    get_latest_version:
      command: "pipx runpip {package} index versions {package} | sed -n 's/.*(\(.*\)).*/\1/p'"
      require_root: false
